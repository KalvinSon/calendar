################
# General Config
################

# disables auto-listing directory contents
Options -Indexes

# works???
ErrorDocument 403 /public/403.html
ErrorDocument 404 /public/404.html

# disable forcing slashes on directory URLs
# (causes resolution of index.html to break, thus the RewriteRule below)
DirectorySlash Off

RewriteEngine on

# allows mod_rewrite on a direct request to current directory, despite `DirectorySlash Off`
RewriteOptions AllowNoSlash

##################
# General Rewrites
##################

# prevents serving hidden files like .htaccess and .git
# (leading slash means start-of-directory)
RedirectMatch 404 "/\."

# removes www
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ %{ENV:PROTO}://%1%{REQUEST_URI} [R=301,L]

# removes trailing slashes
RewriteCond %{REQUEST_URI} ^(/.*)/$
RewriteRule .* %1 [R=301,L]

#######################
# App-Specific Rewrites
#######################

# directory indexes (necessary because of `DirectorySlash Off`)
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule .* $0/index.html [L]

# articles (matches any nonexistent files)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule .* $0.html [L]

# doc urls for prereleases that became real releases
# last rule here works???
RewriteRule ^v5/(.*) $1 [R=301,L]
RewriteRule ^v5 . [R=301,L]

# renamed release-notes
RewriteRule ^v4/release-notes v4/upgrading-from-v3 [R=301,L]

# favicon legacy paths old browsers might request
# needed after we fully convert to gatsby???
# TODO: move to root repo because it handles root urls
RewriteRule ^(favicon|browserconfig|mstile)(\.|\-).*$ assets/favicon/$0 [L]

# TODO: add not about how this ends up in _site dir
# TODO: test all docs urls (/docs/, /docs/v5/, /docs/v3/, etc)
# TODO: what about caching? emulate what's in /api/
